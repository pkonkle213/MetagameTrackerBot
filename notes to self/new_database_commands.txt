This script is a way to select all of the archetypes and calculate win percentage. This needs to be adapted to future state of the database, as it eliminates the need for the 'archetype_played' column in participants. This will mean that inputting participants needs to eliminate submitting 'UNKNOWN' as a player's archetype. Eventually, this should also reference a 'disabled' column on inputtracker in a WHERE segment so that stores can report offensive archetype names that were submitted. Maybe I should also consider renaming 'inputtracker' to a more appropriate name? archetype_submissions?


WITH X AS (SELECT DISTINCT on (event_id, player_name)
  event_id, player_name, archetype_played
FROM inputtracker
WHERE event_id IN
  (SELECT id
  FROM events
  WHERE discord_id = 1210746744602890310
  AND event_date BETWEEN '2025-01-01' AND current_date
  order by event_date desc)
ORDER BY event_id, player_name, date_submitted desc)
SELECT COALESCE(X.archetype_played,'UNKNOWN') as archetype_played, sum(p.wins) as wins, sum(p.losses) as losses, sum(p.draws) as draws, sum(p.wins) * 1.0 / (sum(p.wins)+sum(p.losses)+sum(p.draws)) as winpercentage
FROM participants p
LEFT OUTER JOIN X on X.event_id = p.event_id and X.player_name = p.player_name
WHERE p.event_id IN
  (SELECT id
  FROM events
  WHERE discord_id = 1210746744602890310
  AND event_date BETWEEN '2025-01-01' AND current_date
  order by event_date desc)
GROUP BY 1